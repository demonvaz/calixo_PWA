# App Flow Document

## Onboarding and Sign-In/Sign-Up
A new user lands on the Calixo welcome screen, which can be reached by opening the PWA link or installing the app to their home screen. From this screen, the user chooses to either sign up or sign in. To sign up with email, they enter their email address, choose a password, confirm it, and accept the terms. Real-time validation flags any weak password or invalid email format. Alternatively, users may tap the Google button to authenticate via OAuth, granting permission to share basic profile data. After signing up, the user is prompted to choose a base color for their CALI avatar in an initial personalization step. If the user forgets their password, they tap a “Forgot password” link, enter their email, and receive a reset link to set a new password. Once authenticated, the app stores the user session with Supabase Auth and redirects them to the main feed. Signing out happens via a button in the profile menu, which clears the session and returns the user to the welcome screen.

## Main Dashboard or Home Page
Upon logging in, the user arrives at the home page where the main feed is front and center. A top bar displays the Calixo logo, a notification bell icon, and a menu avatar for profile access. A responsive sidebar on larger screens offers quick links to Feed, Daily Challenges, Focus Mode, Social Challenges, Store, Profile, Settings, and, if the user has admin privileges, the Admin Panel. On mobile, a bottom navigation bar presents the same options. The feed shows completed challenges by people the user follows, each in a square card with an image, a note, the CALI avatar reflecting energy level, and a blue verification tick if the author is premium. The user can pull to refresh the feed or scroll to load more. If the app detects no connection, it shows an offline banner and falls back to cached feed content.

## Detailed Feature Flows and Page Transitions
When the user taps Daily Challenges, a modal appears with the assigned challenge for that day and a countdown timer until the next reset at 5 AM. They start the challenge and the PWA sends a session_start event to the backend. If the browser tab loses focus or the device locks, the app sends a visibility change event and resets the timer when focus returns. On successful completion, a form opens to upload a square photo and add a note. The image is uploaded to Supabase Storage, processed to 1080 px maximum, and stored with a signed URL. After submission, the user collects the configured reward in coins and is invited to share in the feed.

Choosing Focus Mode leads to a page where the user sets a duration up to 23 hours. Once confirmed, the timer screen displays elapsed time, session event tracking, and a progress bar. At the end of an uninterrupted session, the user sees a calm celebration animation and the coin reward. If the session is interrupted by visibility change, the app shows a sad animation and offers to restart the same focus session.

In Social Challenges, the user opens a creation form to name the challenge, pick a duration under 23 hours, and search to invite friends. Invited users receive an in-app alert and, if they opted in, a push notification. Each participant gets an individual timer. When any participant completes their own challenge, they can upload a photo and note. The shared group feed groups all posts under that challenge. Swiping left or right on the group post lets the user view each participant’s entry.

The CALI Avatar Editor is accessible from the profile page or immediately after completing a challenge when new cosmetics unlock. The editor shows tabs for categories like color, shirt, background, and accessories. Locked categories display a transparent overlay stating that items must be unlocked. Selecting an unlocked category reveals the user’s owned items. A real-time preview shows changes on the CALI layers. Saving sends an API call and animates a confirmation. The editor respects reduced-motion preferences and stays under 800 ms for any transition.

The Store page lists all cosmetic items with images, price in coins, and a “Premium” label on items exclusive to premium users. Non-premium users see those items grayed out. When a user confirms a purchase, the app calls the backend to record the transaction, add the item to the user’s unlocked categories, and if it is the first in its category, enable that category in the editor. The interface then offers a quick link to customize CALI.

Tapping the profile icon opens the user’s public profile view by default. Here the avatar CALI, username, total challenges completed, followers, following count, streak, and milestones appear. Below are challenge posts if the profile is public. When the user switches to private in Settings, visitors only see the avatar, username, summary counters, and a Follow button. New follow requests appear as in-app notifications for the profile owner to approve or decline.

Notifications are accessible from the bell icon, opening an in-app list of alerts for comments, invites, daily reset reminders, and badge achievements. Push web notifications require service worker subscription and appear even when the PWA is closed. They are used sparingly to remind about daily challenges and social events. Users toggle notifications on or off in Settings.

Administrators access the Admin Panel from the sidebar when their account flag allows it. They first pick a mode between Admin and Moderator. In Admin mode, they see sections to CRUD official challenges, adjust parameters such as reward_daily and reward_focus via an online form, manage cosmetic items and premiumOnly flags, view subscription logs from Stripe webhooks, generate or expire coupon codes, and review suspicious session events flagged by the backend. In Moderator mode, they see reported content lists, scan comments or images containing banned words from the database, hide or restore content, and notify users of potential expulsion. All admin actions use secure API routes with typed error handling.

## Settings and Account Management
The Settings page is where the user manages language (Spanish by default), notification preferences, and accessibility options including reduced motion. They also view subscription status, choose between the monthly or annual plan showing the annual savings, enter a coupon code, and complete payment via Stripe’s hosted fields. Successful subscription updates the isPremium flag and enables premium features. Cancelling or payment failures show clear messages and steps to retry. From Settings, the user can update their email, change password after entering the current one, and delete the account. After saving any change, a toast confirms success and the user remains in Settings or taps the Back button to return to the main app.

## Error States and Alternate Paths
If the user enters invalid data at sign-up or profile edit, inline error messages appear under each field, and the form prevent submission. During image upload, files exceeding 5 MB or wrong formats trigger a clear notice and the upload is rejected. In low or no network scenarios, a custom offline page appears explaining limited functionality. The feed and essential screens remain available from cache, but starting new challenges or payments is disabled. If a Stripe payment fails, the user sees the error from Stripe, with an option to retry. When unauthorized API calls return a 401 error, the app redirects to sign-in. During a social invite, if the invited user declines, the creator sees that status next to their name in the invite list.

## Conclusion and Overall App Journey
From the first time a user signs up, selects a color for CALI, and explores the feed, they quickly learn about daily, focus, and social challenges through simple modals and onboarding tips. Every action, from starting a challenge to personalizing the avatar or buying cosmetics in the store, flows naturally with clear transitions and accessible feedback. Settings tie everything together, letting users control privacy, notifications, and subscriptions. Offline support and notifications keep users engaged, while an admin area ensures the community stays healthy. At every step, the journey leads back to completing challenges, earning coins, customizing CALI, and sharing moments in a caring social environment that prioritizes well-being and digital disconnection.